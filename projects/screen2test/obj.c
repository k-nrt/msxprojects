#include "pat.h"
#include "obj.h"

#define PAT(x,y) (x+y*16)

#define BLIT  (0x1)
#define FILL  (0x2)
#define HFILL (0x3)
#define END  (0x40)
#define OBJ_BLIT(size,ofsx,ofsy,w,h,end)  (BLIT|end),size,w*h,ofsx,ofsy,w,h
#define OBJ_FILL(size,ofsx,ofsy,w,h,end)  (FILL|end),size,1,ofsx,ofsy,w,h
#define OBJ_HFILL(size,ofsx,ofsy,w,h,end) (HFILL|end),size,1,ofsx,ofsy,w,h

const Obj3d g_obj3dFenceRed[] =
{
	OBJ_FILL(1,-1,0,2,1,0), 0x0a,

	OBJ_FILL(2,-2,-1,4,2,0),0x1a,

	OBJ_BLIT(3,-3,-1,6,3,0),
	0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,
	0x1b,0x1b,0x1b,0x1b,0x1b,0x1b,
	0x2b,0x2b,0x2b,0x2b,0x2b,0x2b,

	OBJ_FILL(4,-4,-2,8,4,0), 0x2a,

	OBJ_FILL(5,-5,-2,10,5,0), 0x2a,

	OBJ_FILL(6,-6,-3,12,6,END), 0x2a,
	0x00,
};

const Obj3d g_obj3dFenceBlue[] =
{
	OBJ_FILL(1,-1,0,2,1,0), 0x0c,

	OBJ_FILL(2,-2,-1,4,2,0),0x1c,

	OBJ_BLIT(3,-3,-1,6,3,0),
	0x0d,0x0d,0x0d,0x0d,0x0d,0x0d,
	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,
	0x2d,0x2d,0x2d,0x2d,0x2d,0x2d,

	OBJ_FILL(4,-4,-2,8,4,0), 0x2c,

	OBJ_FILL(5,-5,-2,10,5,0), 0x2c,

	OBJ_FILL(6,-6,-3,12,6,END), 0x2c,
	0x00,
};

const Obj3d g_obj3dFenceWhite[] =
{
	OBJ_FILL(1,-1,0,2,1,0), 0x0e,

	OBJ_FILL(2,-2,-1,4,2,0),0x1e,

	OBJ_BLIT(3,-3,-1,6,3,0),
	0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,
	0x1f,0x1f,0x1f,0x1f,0x1f,0x1f,
	0x2f,0x2f,0x2f,0x2f,0x2f,0x2f,

	OBJ_FILL(4,-4,-2,8,4,0), 0x2e,

	OBJ_FILL(5,-5,-2,10,5,0), 0x2e,

	OBJ_FILL(6,-6,-3,12,6,END), 0x2e,
	0x00,
};

const Obj3d g_obj3dBuilding1Left[] = 
{
	OBJ_FILL(1,0,0,1,1,0),
	0x80,

	OBJ_FILL(2,-1,-1,2,2,0),
	0x80,

	OBJ_FILL(3,-2,-2,3,3,0),
	0x81,

	OBJ_FILL(4,-2,-2,4,4,0),
	0x81,

	OBJ_BLIT(6,-3,-3,6,6,0),
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93,
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93,
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93,

	OBJ_BLIT(8,-4,-4,8,8,0),
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93, 0x92, 0x93,
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93, 0x92, 0x93,
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93, 0x92, 0x93,
	0x82, 0x83, 0x82, 0x83, 0x82, 0x83, 0x82, 0x83,
	0x92, 0x93, 0x92, 0x93, 0x92, 0x93, 0x92, 0x93,

	0x00,
};

const Obj3d g_obj3dBuilding2Left[] = 
{
	OBJ_FILL(1,0,0,1,1,0),
	0xa0,

	OBJ_FILL(2,-1,-1,2,2,0),
	0xa0,

	OBJ_FILL(3,-2,-2,3,3,0),
	0xa1,

	OBJ_FILL(4,-2,-2,4,4,0),
	0xa1,

	OBJ_BLIT(6,-3,-3,6,6,0),
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,

	OBJ_BLIT(8,-4,-4,8,8,0),
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,
	0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3, 0xa2, 0xa3,
	0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3, 0xb2, 0xb3,

	0x00,
};


const Obj3d g_obj3dBuildingLeft[] = 
{
	OBJ_BLIT(1,0,0,1,1,0),
	0x51,

	OBJ_BLIT(2,-1,-1,2,2,0),
	0x40,0x41,
	0x50,0x51,

	OBJ_BLIT(3,-1,-1,3,3,0),
	0x40,0x42,0x41,
	0x50,0x52,0x51,
	0x40,0x40,0x43,

	OBJ_BLIT(4,-2,-2,4,4,0),
	0x40,0x42,0x43,0x41,
	0x50,0x52,0x53,0x51,
	0x40,0x40,0x43,0x42,
	0x50,0x50,0x53,0x52,

	OBJ_BLIT(5,-2,-2,5,5,0),
	0x40,0x42,0x43,0x41,0x01,
	0x50,0x52,0x53,0x51,0x01,
	0x40,0x40,0x43,0x42,0x41,
	0x50,0x50,0x53,0x52,0x51,
	0x40,0x40,0x40,0x42,0x43,

	OBJ_BLIT(6,-3,-3,6,6,0),
	0x40,0x42,0x43,0x42,0x41,0x01,
	0x50,0x52,0x53,0x52,0x51,0x01,
	0x40,0x40,0x43,0x42,0x43,0x41,
	0x50,0x50,0x53,0x52,0x53,0x51,
	0x40,0x40,0x40,0x42,0x43,0x42,
	0x50,0x50,0x50,0x52,0x53,0x52,

	OBJ_BLIT(8,-4,-4,8,8,END),
	0x40,0x42,0x43,0x42,0x43,0x42,0x41,0x01,
	0x50,0x52,0x53,0x52,0x53,0x52,0x51,0x01,
	0x40,0x40,0x43,0x42,0x43,0x42,0x43,0x41,
	0x50,0x50,0x53,0x52,0x53,0x52,0x53,0x51,
	0x40,0x40,0x40,0x42,0x43,0x42,0x43,0x42,
	0x50,0x50,0x50,0x52,0x53,0x52,0x53,0x52,
	0x40,0x40,0x40,0x42,0x43,0x42,0x43,0x42,
	0x50,0x50,0x50,0x52,0x53,0x52,0x53,0x52,
	0x00,
};

const Obj3d g_obj3dBuildingRight[] = 
{
	OBJ_BLIT(1,0,0,1,1,0),
	0x71,

	OBJ_BLIT(2,-1,-1,2,2,0),
	0x61,0x60,
	0x71,0x70,

	OBJ_BLIT(3,-1,-1,3,3,0),
	0x61,0x62,0x60,
	0x71,0x72,0x70,
	0x63,0x60,0x60,

	OBJ_BLIT(4,-2,-2,4,4,0),
	0x63,0x62,0x63,0x62,
	0x73,0x72,0x73,0x72,
	0x63,0x62,0x63,0x62,
	0x73,0x72,0x73,0x72,

	OBJ_BLIT(5,-2,-2,5,5,0),
	0x01,0x61,0x63,0x62,0x60,
	0x01,0x71,0x73,0x72,0x70,
	0x61,0x62,0x63,0x60,0x60,
	0x71,0x72,0x73,0x70,0x70,
	0x63,0x62,0x60,0x60,0x60,

	OBJ_BLIT(6,-3,-3,6,6,0),
	0x01,0x61,0x63,0x62,0x63,0x60,
	0x01,0x71,0x73,0x72,0x73,0x70,
	0x61,0x62,0x63,0x62,0x60,0x60,
	0x71,0x72,0x73,0x72,0x70,0x70,
	0x63,0x62,0x63,0x60,0x60,0x60,
	0x73,0x72,0x73,0x70,0x70,0x70,

	OBJ_BLIT(8,-4,-4,8,8,END),
	0x01,0x61,0x63,0x62,0x63,0x62,0x63,0x60,
	0x01,0x71,0x73,0x72,0x73,0x72,0x73,0x70,
	0x61,0x62,0x63,0x62,0x63,0x62,0x60,0x60,
	0x71,0x72,0x73,0x72,0x73,0x72,0x70,0x70,
	0x63,0x62,0x63,0x62,0x63,0x60,0x60,0x60,
	0x73,0x72,0x73,0x72,0x73,0x70,0x70,0x70,
	0x63,0x62,0x63,0x62,0x60,0x60,0x60,0x60,
	0x73,0x72,0x73,0x72,0x70,0x70,0x70,0x70,
	0x00,
};

const Obj3d g_obj3dRoad0[] =
{
	OBJ_HFILL(4,0,0,0,1,0),0x24,
	OBJ_HFILL(8,0,0,0,2,0),0x25,
	OBJ_HFILL(12,0,0,0,3,0),0x26,
	OBJ_HFILL(16,0,0,0,4,END),0x27,
};

const Obj3d g_obj3dRoad1[] =
{
	OBJ_HFILL(4,0,0,0,1,0),0x34,
	OBJ_HFILL(8,0,0,0,2,0),0x35,
	OBJ_HFILL(12,0,0,0,3,0),0x36,
	OBJ_HFILL(16,0,0,0,4,END),0x37,
	/*
	OBJ_HFILL(8,-4,0,8,1),0x34,
	OBJ_HFILL(10,-5,0,10,1),0x34,
	OBJ_HFILL(12,-6,0,12,1),0x35,
	OBJ_HFILL(14,-7,0,14,1),0x35,
	OBJ_HFILL(16,-8,0,16,2),0x36,
	OBJ_HFILL(18,-9,0,18,2),0x36,
	OBJ_HFILL(20,-10,0,20,3),0x36,
	OBJ_HFILL(22,-11,0,22,3),0x37,
	OBJ_HFILL(24,-12,0,24,3),0x37,
	OBJ_HFILL(26,-13,0,26,3),0x37,
	OBJ_HFILL(28,-14,0,28,4),0x37,
	OBJ_HFILL(30,-15,0,30,4),0x37,
	OBJ_HFILL(32,-16,0,32,4),0x37,
	OBJ_HFILL(36,-18,0,36,4),0x37,
	OBJ_HFILL(40,-20,0,40,4),0x37,
	OBJ_HFILL(44,-22,0,40,4),0x37,
	OBJ_HFILL(48,-24,0,48,4),0x37,
	OBJ_HFILL(52,-26,0,52,4),0x37,
	OBJ_HFILL(56,-28,0,56,4),0x37,
	OBJ_HFILL(60,-30,0,60,4),0x37,
	OBJ_HFILL(64,-32,0,64,4),0x37,
	*/
	0x00,
};

const Obj3d g_obj3dTreeDark[] = 
{
	OBJ_BLIT(1,0,-1,1,1,0),
	0x48,

	OBJ_BLIT(2,-1,-1,2,2,0),
	0x49, 0x4a,
	0x59, 0x5a,

	OBJ_BLIT(3,-2,-2,3,3,0),
	0x4b, 0x58, 0x4c,
	0x58, 0x58, 0x58,
	0x5b, 0x4d, 0x5c,

	OBJ_BLIT(4,-2,-2,4,4,0),
	0x4b, 0x58, 0x58, 0x4c,
	0x58, 0x58, 0x58, 0x58,
	0x58, 0x58, 0x58, 0x58,
	0x5b, 0x4e, 0x4f, 0x5c,

	OBJ_BLIT(6,-3,-3,6,6,END),
	0x4b, 0x58, 0x58, 0x58, 0x58, 0x4c,
	0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
	0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
	0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
	0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
	0x5b, 0x5b, 0x4e, 0x4f, 0x5c, 0x5c,
	0x00,
};

const Obj3d g_obj3dTreeLight[] = 
{
	OBJ_BLIT(1,0,-1,1,1,0),
	0x68,

	OBJ_BLIT(2,-1,-1,2,2,0),
	0x69, 0x6a,
	0x79, 0x7a,

	OBJ_BLIT(3,-2,-2,3,3,0),
	0x6b, 0x78, 0x6c,
	0x78, 0x78, 0x78,
	0x7b, 0x6d, 0x7c,

	OBJ_BLIT(4,-2,-2,4,4,0),
	0x6b, 0x78, 0x78, 0x6c,
	0x78, 0x78, 0x78, 0x78,
	0x78, 0x78, 0x78, 0x78,
	0x7b, 0x6e, 0x6f, 0x7c,

	OBJ_BLIT(6,-3,-3,6,6,END),
	0x6b, 0x78, 0x78, 0x78, 0x78, 0x6c,
	0x78, 0x78, 0x78, 0x78, 0x78, 0x78,
	0x78, 0x78, 0x78, 0x78, 0x78, 0x78,
	0x78, 0x78, 0x78, 0x78, 0x78, 0x78,
	0x78, 0x78, 0x78, 0x78, 0x78, 0x78,
	0x7b, 0x7b, 0x6e, 0x6f, 0x7c, 0x7c,
	0x00,
};


void Obj3dBlit( s8 x, s8 y, int size, const Obj3d *pObj3d )
{
	const char* pObj = pObj3d;
	u8 nType, nSize, nSkip;
	s8 ofsx,ofsy,w,h;

	for( ; *pObj != 0x0 ; )
	{
		nType = *(u8*) pObj; pObj++;
		nSize = *(u8*) pObj; pObj++;
		nSkip = *(u8*) pObj; pObj++;
		
		if( size <= nSize || (nType & END) )
		{
			ofsx = *pObj; pObj++;
			ofsy = *pObj; pObj++;
			w = *pObj; pObj++;
			h = *pObj; pObj++;

			if( (nType & 0xf) == BLIT )
			{
				PatBlit( x + ofsx, y + ofsy, w, h, (const u8*) pObj );
			}
			else if( (nType & 0xf) == FILL )
			{
				PatFill( x + ofsx, y + ofsy, w, h, *pObj );
			}
			else if( (nType & 0xf) == HFILL )
			{
				PatFill( 0, y + ofsy, 32, h, *pObj );
			}
			return;
		}
		else
		{
			pObj += 4;
			pObj += nSkip;
		}
	}
}


void ObjBlit( s8 x, s8 y, int size, const struct SObj *pObj )
{
	if( pObj->type == kObjType_4x4 )
	{
		const struct SObj4x4 *pObj4x4 = (const struct SObj4x4*) pObj;
		
		if( size < 2 )
		{
			PatBlit( x, y, 1, 1, pObj4x4->p1x1 );
		}
		else  if( size < 3 )
		{
			PatBlit( x-1, y-1, 2, 2, pObj4x4->p2x2 );
		}
		else if( size < 4 )
		{
			PatBlit( x-1, y-1, 3, 3, pObj4x4->p3x3 );
		}
		else
		{
			PatBlit( x-2, y-2, 4, 4, pObj4x4->p4x4 );
		}
	}
	else if( pObj->type == kObjType_32x1 )
	{
		const struct SObj32x1 *pObj32x1 = (const struct SObj32x1*) pObj;
		if( size < 8 )
		{
			PatBlit( x-4, y, 8, 1, pObj32x1->p8x1 );
		}
		else if( size < 10 )
		{
			PatBlit( x-5, y, 10, 1, pObj32x1->p10x1 );
		}
		else if( size < 16 )
		{
			PatBlit( x-8, y, 16, 1, pObj32x1->p16x1 );
		}
		else if( size < 18 )
		{
			PatBlit( x-9, y, 18, 1, pObj32x1->p18x1 );
		}
		else if( size < 24 )
		{
			PatBlit( x-12, y, 24, 2, pObj32x1->p24x1 );
		}
		else
		{
			PatBlit( x-16, y, 32, 4, pObj32x1->p32x1 );
		}
	}
}
